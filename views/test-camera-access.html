<!DOCTYPE html>
<html>
<head>
    <title>Camera Access Test</title>
    <link href="/css/styles.css" rel="stylesheet">
    <!-- Auto-redirect to HTTPS for camera access -->
    <script>
      if (window.location.protocol === 'http:' && !window.location.hostname.includes('localhost')) {
        const httpsUrl = window.location.href.replace('http:', 'https:').replace(':8080', ':8443');
        window.location.href = httpsUrl;
      }
    </script>
</head>
<body class="font-sans m-5 bg-gray-100">
    <div class="max-w-4xl mx-auto bg-white p-5 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold mb-5">üé• Camera Access Test</h1>
        
        <div class="bg-blue-100 text-blue-800 p-3 mb-5 rounded font-semibold">
            <strong>Current Protocol:</strong> <span id="protocol"></span><br>
            <strong>Current Host:</strong> <span id="host"></span>
        </div>

        <div class="bg-gray-50 p-4 rounded mb-5">
            <h3 class="text-lg font-semibold mb-3">üìã Available URLs</h3>
            <div class="bg-white p-2 rounded mb-2">
                <strong>HTTP (Local):</strong> <a href="http://localhost:8080" target="_blank" class="text-blue-600 hover:underline">http://localhost:8080</a>
            </div>
            <div class="bg-white p-2 rounded mb-2">
                <strong>HTTPS (Local):</strong> <a href="https://localhost:8443" target="_blank" class="text-blue-600 hover:underline">https://localhost:8443</a>
            </div>
            <div class="bg-white p-2 rounded mb-2">
                <strong>HTTP (Network):</strong> <a href="http://192.168.1.117:8080" target="_blank" class="text-blue-600 hover:underline">http://192.168.1.117:8080</a>
            </div>
            <div class="bg-white p-2 rounded mb-2">
                <strong>HTTPS (Network):</strong> <a href="https://192.168.1.117:8443" target="_blank" class="text-blue-600 hover:underline">https://192.168.1.117:8443</a>
            </div>
            <div class="bg-white p-2 rounded">
                <strong>WSS Port:</strong> 8444 (for WebSocket connections)
            </div>
        </div>

        <button class="bg-blue-500 text-white px-5 py-2 rounded mr-2 hover:bg-blue-600 cursor-pointer" onclick="testCamera()">üîç Test Camera Access</button>
        <button class="bg-gray-500 text-white px-5 py-2 rounded hover:bg-gray-600 cursor-pointer" onclick="clearStatus()">üóëÔ∏è Clear Status</button>
        
        <div id="status" class="mt-5"></div>
        <video id="testVideo" autoplay muted playsinline class="w-full max-w-md h-72 border-2 border-gray-300 rounded my-3"></video>

        <script>
            // Display current protocol and host
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('host').textContent = window.location.host;
            
            function addStatus(message, type = 'info') {
                const statusDiv = document.getElementById('status');
                const statusClass = type === 'success' ? 'bg-green-100 text-green-800' : 
                                  type === 'error' ? 'bg-red-100 text-red-800' : 
                                  'bg-blue-100 text-blue-800';
                statusDiv.innerHTML += `<div class="${statusClass} p-3 rounded mb-2 font-semibold">${message}</div>`;
            }
            
            function clearStatus() {
                document.getElementById('status').innerHTML = '';
            }
            
            async function testCamera() {
                try {
                    addStatus('üîç Requesting camera access...', 'info');
                    
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    });
                    
                    const video = document.getElementById('testVideo');
                    video.srcObject = stream;
                    
                    addStatus('‚úÖ Camera access granted! Video should be visible above.', 'success');
                    addStatus(`üìπ Video tracks: ${stream.getVideoTracks().length}`, 'info');
                    addStatus(`üé§ Audio tracks: ${stream.getAudioTracks().length}`, 'info');
                    
                    // Test WebSocket connection
                    testWebSocket();
                    
                } catch (error) {
                    addStatus(`‚ùå Camera access denied: ${error.message}`, 'error');
                    addStatus('üí° Make sure you\'re using HTTPS or localhost', 'info');
                    addStatus('üí° Check that your browser supports getUserMedia', 'info');
                }
            }
            
            function testWebSocket() {
                addStatus('üîå Testing WebSocket connection...', 'info');
                
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const host = window.location.hostname;
                const port = window.location.protocol === 'https:' ? '8444' : '3000';
                const wsUrl = `${protocol}//${host}:${port}`;
                
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    addStatus('‚úÖ WebSocket connection successful!', 'success');
                    ws.close();
                };
                
                ws.onerror = (error) => {
                    addStatus(`‚ùå WebSocket connection failed: ${error}`, 'error');
                };
                
                ws.onclose = () => {
                    addStatus('üîå WebSocket connection closed', 'info');
                };
            }
            
            // Auto-test on page load
            setTimeout(() => {
                testCamera();
            }, 1000);
        </script>
    </div>
</body>
</html> 